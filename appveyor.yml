version: 1.0.{build}
pull_requests:
  do_not_increment_build_number: true
branches:
  only:
  - master
  - develop
init:
- ps: "function gitVersion(){\n    write-host \"This gets the version nr from the end of the git release branch (e.g.: v1.4). And updates the appVersion build version with that (the build nr is appended).\"\n\n    $branch=$env:APPVEYOR_REPO_BRANCH\n\n    $posAfterVchar = $branch.LastIndexOf(\"v\") + 1\n    $versionLength = $branch.Length - $posAfterVchar\n    \n    $gitVersion=$branch.substring($posAfterVchar, $versionLength)\n    \n    $newVersion=\"$gitVersion.$env:APPVEYOR_BUILD_NUMBER\"\n    \n    write-host \"Update appveyor build version to:$newVersion\"\n    $env:appveyor_build_version=\"$newVersion\"\n    appveyor UpdateBuild -Version \"$newVersion\"\n}\ngitVersion"  
assembly_info:
  patch: true
  file: '**\AssemblyInfo.*'
  assembly_version: '{version}'
  assembly_file_version: '{version}'
  assembly_informational_version: '{version}'
dotnet_csproj:
  patch: true
  file: '**\*.csproj'
  version: '{version}'
  version_prefix: '{version}'
  package_version: '{version}'
  assembly_version: '{version}'
  file_version: '{version}'
  informational_version: '{version}'
environment:
  MyGetApiKey:
    secure: kDoo1IiHXI3ui641kE3luA3a2uic12F2AeHTOoOzs93zdcIn3A9fsYg3ka31nwnO
  NugetApiKey:
    secure: G5HVnr8m/5cnqGweoUslJ2cY5b+KjZ1t0Cz3WUlIMV8ZiUhaNmWbdfPUFG5kXBWR
cache: packages -> **\packages.config
nuget:
  account_feed: true
  project_feed: true
before_build:
  - ps: gitversion /l console /output buildserver
  - cmd: appveyor-retry dotnet restore .\build\  --disable-parallel --configfile .\nuget.config.xml --packages .\packages
  - cmd: appveyor-retry dotnet restore .\Src\  --disable-parallel --configfile .\nuget.config.xml --packages .\packages
build:
  project: /Src/
  publish_core_console: true
  parallel: true
  verbosity: normal
test_script:
- cmd: cd .\Src\ && dotnet test -l "console"
deploy_script:
- cmd: dotnet pack ./EzDbCodeGen.Cli/ -o ../artifacts/ --version-suffix "ci-1234"
notifications:
- provider: Email
  to:
  - rvegajr@noctsuft.com
  subject: Ez Db Code Gen has been successfully deployed
  on_build_success: true
  on_build_failure: true
  on_build_status_changed: false